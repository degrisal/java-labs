<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
    <title th:text="${title}"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  
    <header th:insert="blocks/header :: header"></header>
    <form action="/workers" method="get">
      <input type="text" id="search" name="search" placeholder="Поиск" class="form-control" oninput="searchWorkers()"/>
      <div id="searchResults" class="mt-2"></div>
      <button type="submit" class="btn btn-success">Найти</button>
    </form>
      <div class="container mt-5" >
        <h1 th:text="${title}"></h1>
        <div th:each="el : ${workers}" class="alert alert-info mt-2">
          <p><b>ФИО:</b>
            <span th:text="${el.FirstName}"/>
            <span th:text=" ${el.SecondName}"/>
            <span th:text=" ${el.ThirdName}"/>
          </p>
          <p><b>Должность:</b>
            <span th:text="${el.Rank}"/>
          </p>
          <p><b>Подразделение:</b>
            <span th:text="${el.Branch}"/>
          </p>
          <p>
            <a th:href="'/worker/edit/' + ${el.id}"class="btn btn-warning">Редактировать</a>
            <a th:href="'/worker/' + ${el.id}" class="btn btn-warning">Детальнее</a>
            <form th:action="'/worker/delete/' + ${el.id}" method="post">
              <button type="submit" class="btn btn-warning">Удалить</button>
            </form>
          </p>
        </div>
      </div>
    <div th:insert="blocks/footer :: footer"></div>

    <script>
      $(document).ready(function() {
        $("#search").on("input", function() {
          var search = $(this).val();
          if (search.length < 2) {
            return;
          }
          $.ajax({
            url: "/workers/search",
            method: "GET",
            data: { search: search },
            success: function(data) {
              var table = $("<table class='table'></table>");
              $(data).each(function(index, worker) {
                table.append("<tr><td>" + worker.firstName + " " + worker.secondName + "</td><td>" + worker.rank + "</td><td>" + worker.branch + "</td></tr>");
              });
              $("#searchResults").html(table);
            }
          });
        });
      });
      
    </script>
    
</body>
</html>